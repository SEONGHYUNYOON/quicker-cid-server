<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Quicker ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <style>
        body {
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .member-form {
            margin-bottom: 20px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #f8f9fa;
        }
        .cid-container {
            margin-top: 10px;
        }
        .cid-input {
            margin-bottom: 10px;
        }
        .search-box {
            margin-bottom: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 5px;
        }
        .date-filter {
            margin-bottom: 15px;
        }
        .table th, .table td {
            text-align: center;
            vertical-align: middle;
        }
        .table th {
            background-color: #f8f9fa;
        }
        .expired {
            background-color: #ffe6e6;
        }
        .expiring-soon {
            background-color: #fff3cd;
        }
        .edit-form {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.3);
            z-index: 1000;
            width: 80%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
        }
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 999;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">Quicker ê´€ë¦¬ì</a>
            <div class="navbar-nav me-auto">
                <a class="nav-link" href="#" onclick="showMembers()">íšŒì› ê´€ë¦¬</a>
                <a class="nav-link" href="#" onclick="showApiKeys()">API í‚¤ ê´€ë¦¬</a>
                <a class="nav-link" href="#" onclick="showApiLogs()">API ë¡œê·¸</a>
                <a class="nav-link" href="#" onclick="showBackups()">ë°±ì—… ê´€ë¦¬</a>
                <a class="nav-link" href="#" onclick="showStats()">í†µê³„</a>
            </div>
            <div class="d-flex">
                <button class="btn btn-outline-light me-2" data-bs-toggle="modal" data-bs-target="#changePasswordModal">
                    ë¹„ë°€ë²ˆí˜¸ ë³€ê²½
                </button>
                <a href="/logout" class="btn btn-danger">ë¡œê·¸ì•„ì›ƒ</a>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <!-- íšŒì› ê´€ë¦¬ ì„¹ì…˜ -->
        <div id="membersSection">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h2>íšŒì› ê´€ë¦¬</h2>
                <div>
                    <button class="btn btn-success me-2" onclick="exportExcel()">ì—‘ì…€ ë‚´ë³´ë‚´ê¸°</button>
                    <button class="btn btn-primary" onclick="showAddMemberForm()">íšŒì› ì¶”ê°€</button>
                </div>
            </div>

            <div class="search-box">
                <div class="row">
                    <div class="col-md-6">
                        <input type="text" class="form-control" id="searchInput" placeholder="ì´ë¦„, ì „í™”ë²ˆí˜¸, CIDë¡œ ê²€ìƒ‰">
                    </div>
                    <div class="col-md-6">
                        <div class="btn-group" role="group">
                            <button class="btn btn-outline-primary" onclick="filterByDate('today')">ì˜¤ëŠ˜</button>
                            <button class="btn btn-outline-primary" onclick="filterByDate('week')">7ì¼ ì´ë‚´</button>
                            <button class="btn btn-outline-primary" onclick="filterByDate('month')">1ê°œì›” ì´ë‚´</button>
                            <button class="btn btn-outline-secondary" onclick="resetFilter()">í•„í„° ì´ˆê¸°í™”</button>
                        </div>
                    </div>
                </div>
            </div>

            <div id="addMemberForm" class="member-form" style="display: none;">
                <h3>íšŒì› ì¶”ê°€</h3>
                <form id="memberForm">
                    <div class="mb-3">
                        <label class="form-label">ì´ë¦„</label>
                        <input type="text" class="form-control" name="name" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">ì „í™”ë²ˆí˜¸</label>
                        <input type="text" class="form-control" name="phone" required onblur="checkPhoneDuplicate(this)">
                        <div id="phoneValidation" class="form-text"></div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">ë“±ë¡ì¼</label>
                        <input type="text" class="form-control datepicker" name="registration_date" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">ë§Œë£Œì¼</label>
                        <input type="text" class="form-control datepicker" name="expiry_date" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">ì…ê¸ˆì•¡</label>
                        <input type="text" class="form-control" name="deposit_amount" onkeyup="formatNumber(this)">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">ì¶”ì²œì¸</label>
                        <input type="text" class="form-control" name="referrer">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">CID</label>
                        <div id="cidInputs" class="cid-container">
                            <div class="cid-input">
                                <input type="text" class="form-control" name="cids[]">
                            </div>
                        </div>
                        <button type="button" class="btn btn-secondary mt-2" onclick="addCidInput()">CID ì¶”ê°€</button>
                    </div>
                    <button type="submit" class="btn btn-primary">ì €ì¥</button>
                    <button type="button" class="btn btn-secondary" onclick="hideAddMemberForm()">ì·¨ì†Œ</button>
                </form>
            </div>

            <div class="table-responsive">
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>ì´ë¦„</th>
                            <th>ì „í™”ë²ˆí˜¸</th>
                            <th>ë“±ë¡ì¼</th>
                            <th>ë§Œë£Œì¼</th>
                            <th>ì…ê¸ˆì•¡</th>
                            <th>ì¶”ì²œì¸</th>
                            <th>CID</th>
                            <th>ì‘ì—…</th>
                        </tr>
                    </thead>
                    <tbody id="membersList">
                    </tbody>
                </table>
            </div>
        </div>

        <!-- API í‚¤ ê´€ë¦¬ ì„¹ì…˜ -->
        <div id="apiKeysSection" style="display: none;">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h2>API í‚¤ ê´€ë¦¬</h2>
                <button class="btn btn-primary" onclick="showCreateApiKeyModal()">API í‚¤ ìƒì„±</button>
            </div>
            <div class="table-responsive">
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>ì´ë¦„</th>
                            <th>API í‚¤</th>
                            <th>ìƒì„±ì¼</th>
                            <th>ë§ˆì§€ë§‰ ì‚¬ìš©</th>
                            <th>ìƒíƒœ</th>
                            <th>ì‘ì—…</th>
                        </tr>
                    </thead>
                    <tbody id="apiKeysList"></tbody>
                </table>
            </div>
        </div>

        <!-- API ë¡œê·¸ ì„¹ì…˜ -->
        <div id="apiLogsSection" style="display: none;">
            <h2 class="mb-3">API ë¡œê·¸</h2>
            <div class="table-responsive">
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>ì‹œê°„</th>
                            <th>API í‚¤</th>
                            <th>ì—”ë“œí¬ì¸íŠ¸</th>
                            <th>ë©”ì†Œë“œ</th>
                            <th>ìƒíƒœ</th>
                            <th>IP ì£¼ì†Œ</th>
                        </tr>
                    </thead>
                    <tbody id="apiLogsList"></tbody>
                </table>
            </div>
            <nav>
                <ul class="pagination justify-content-center" id="apiLogsPagination"></ul>
            </nav>
        </div>

        <!-- ë°±ì—… ê´€ë¦¬ ì„¹ì…˜ -->
        <div id="backupsSection" style="display: none;">
            <div class="row">
                <!-- ë°±ì—… ëª©ë¡ -->
                <div class="col-md-8">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h2>ë°±ì—… ê´€ë¦¬</h2>
                        <button class="btn btn-primary" onclick="createBackup()">ìˆ˜ë™ ë°±ì—…</button>
                    </div>
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>ìƒì„±ì¼ì‹œ</th>
                                    <th>íŒŒì¼ëª…</th>
                                    <th>í¬ê¸°</th>
                                    <th>ì„¤ëª…</th>
                                    <th>ìœ í˜•</th>
                                    <th>ì‘ì—…</th>
                                </tr>
                            </thead>
                            <tbody id="backupsList"></tbody>
                        </table>
                    </div>
                </div>
                
                <!-- ë°±ì—… ìŠ¤ì¼€ì¤„ -->
                <div class="col-md-4">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h3>ìë™ ë°±ì—… ì„¤ì •</h3>
                        <button class="btn btn-sm btn-primary" onclick="showCreateScheduleModal()">ìŠ¤ì¼€ì¤„ ì¶”ê°€</button>
                    </div>
                    <div id="schedulesList"></div>
                </div>
            </div>
        </div>

        <!-- í†µê³„ ì„¹ì…˜ -->
        <div id="statsSection" style="display: none;">
            <div class="row mb-4">
                <!-- ê¸°ê°„ ì„ íƒ -->
                <div class="col-12 mb-3">
                    <div class="btn-group" role="group">
                        <button class="btn btn-outline-primary" onclick="loadStats(7)">7ì¼</button>
                        <button class="btn btn-outline-primary active" onclick="loadStats(30)">30ì¼</button>
                        <button class="btn btn-outline-primary" onclick="loadStats(90)">90ì¼</button>
                    </div>
                </div>
                
                <!-- ì£¼ìš” ì§€í‘œ -->
                <div class="col-md-3">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">íšŒì› í˜„í™©</h5>
                            <div class="stats-item">
                                <span>ì „ì²´ íšŒì›</span>
                                <strong id="totalMembers">-</strong>
                            </div>
                            <div class="stats-item">
                                <span>í™œì„± íšŒì›</span>
                                <strong id="activeMembers">-</strong>
                            </div>
                            <div class="stats-item">
                                <span>ì‹ ê·œ íšŒì›</span>
                                <strong id="newMembers">-</strong>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-3">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">CID í˜„í™©</h5>
                            <div class="stats-item">
                                <span>ì „ì²´ CID</span>
                                <strong id="totalCids">-</strong>
                            </div>
                            <div class="stats-item">
                                <span>í™œì„± CID</span>
                                <strong id="activeCids">-</strong>
                            </div>
                            <div class="stats-item">
                                <span>íšŒì›ë‹¹ í‰ê· </span>
                                <strong id="avgCidsPerMember">-</strong>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-3">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">API ì‚¬ìš©ëŸ‰</h5>
                            <div class="stats-item">
                                <span>ì´ í˜¸ì¶œ</span>
                                <strong id="totalApiCalls">-</strong>
                            </div>
                            <div class="stats-item">
                                <span>ì„±ê³µë¥ </span>
                                <strong id="apiSuccessRate">-</strong>
                            </div>
                            <div class="stats-item">
                                <span>ì¼ì¼ í‰ê· </span>
                                <strong id="avgDailyCalls">-</strong>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-3">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">ì…ê¸ˆ í˜„í™©</h5>
                            <div class="stats-item">
                                <span>ì´ ì…ê¸ˆì•¡</span>
                                <strong id="totalDeposit">-</strong>
                            </div>
                            <div class="stats-item">
                                <span>íšŒì›ë‹¹ í‰ê· </span>
                                <strong id="avgDeposit">-</strong>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="row">
                <!-- ì¼ë³„ ì¶”ì´ ì°¨íŠ¸ -->
                <div class="col-md-8">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">ì¼ë³„ ì¶”ì´</h5>
                            <canvas id="dailyTrendsChart"></canvas>
                        </div>
                    </div>
                </div>
                
                <!-- API ì‚¬ìš© ë¶„ì„ -->
                <div class="col-md-4">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">API ì‚¬ìš© ë¶„ì„</h5>
                            <canvas id="apiUsageChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="editFormOverlay" class="overlay" style="display: none;"></div>
    <div id="editMemberForm" class="edit-form" style="display: none;">
        <h3>íšŒì› ì •ë³´ ìˆ˜ì •</h3>
        <form id="editForm">
            <input type="hidden" name="id">
            <div class="mb-3">
                <label class="form-label">ì´ë¦„</label>
                <input type="text" class="form-control" name="name" required>
            </div>
            <div class="mb-3">
                <label class="form-label">ì „í™”ë²ˆí˜¸</label>
                <input type="text" class="form-control" name="phone" required>
            </div>
            <div class="mb-3">
                <label class="form-label">ë“±ë¡ì¼</label>
                <input type="text" class="form-control datepicker" name="registration_date" required>
            </div>
            <div class="mb-3">
                <label class="form-label">ë§Œë£Œì¼</label>
                <input type="text" class="form-control datepicker" name="expiry_date" required>
            </div>
            <div class="mb-3">
                <label class="form-label">ì…ê¸ˆì•¡</label>
                <input type="text" class="form-control" name="deposit_amount" onkeyup="formatNumber(this)">
            </div>
            <div class="mb-3">
                <label class="form-label">ì¶”ì²œì¸</label>
                <input type="text" class="form-control" name="referrer">
            </div>
            <div class="mb-3">
                <label class="form-label">CID</label>
                <div id="editCidInputs" class="cid-container"></div>
                <button type="button" class="btn btn-secondary mt-2" onclick="addEditCidInput()">CID ì¶”ê°€</button>
            </div>
            <button type="submit" class="btn btn-primary">ì €ì¥</button>
            <button type="button" class="btn btn-secondary" onclick="hideEditMemberForm()">ì·¨ì†Œ</button>
        </form>
    </div>

    <!-- ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ëª¨ë‹¬ -->
    <div class="modal fade" id="changePasswordModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="changePasswordForm">
                        <div class="mb-3">
                            <label class="form-label">í˜„ì¬ ë¹„ë°€ë²ˆí˜¸</label>
                            <input type="password" class="form-control" id="currentPassword" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">ìƒˆ ë¹„ë°€ë²ˆí˜¸</label>
                            <input type="password" class="form-control" id="newPassword" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">ìƒˆ ë¹„ë°€ë²ˆí˜¸ í™•ì¸</label>
                            <input type="password" class="form-control" id="confirmPassword" required>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ì·¨ì†Œ</button>
                    <button type="button" class="btn btn-primary" onclick="changePassword()">ë³€ê²½</button>
                </div>
            </div>
        </div>
    </div>

    <!-- API í‚¤ ìƒì„± ëª¨ë‹¬ -->
    <div class="modal fade" id="createApiKeyModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">API í‚¤ ìƒì„±</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="createApiKeyForm">
                        <div class="mb-3">
                            <label class="form-label">ì´ë¦„</label>
                            <input type="text" class="form-control" id="apiKeyName" required>
                            <div class="form-text">API í‚¤ë¥¼ êµ¬ë¶„í•  ìˆ˜ ìˆëŠ” ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”.</div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ì·¨ì†Œ</button>
                    <button type="button" class="btn btn-primary" onclick="createApiKey()">ìƒì„±</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ë°±ì—… ìŠ¤ì¼€ì¤„ ìƒì„± ëª¨ë‹¬ -->
    <div class="modal fade" id="createScheduleModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">ë°±ì—… ìŠ¤ì¼€ì¤„ ì¶”ê°€</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="createScheduleForm">
                        <div class="mb-3">
                            <label class="form-label">ì£¼ê¸°</label>
                            <select class="form-select" id="scheduleFrequency" required>
                                <option value="daily">ë§¤ì¼</option>
                                <option value="weekly">ë§¤ì£¼</option>
                                <option value="monthly">ë§¤ì›”</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">ì‹œê°„</label>
                            <input type="time" class="form-control" id="scheduleTime" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">ë³´ê´€ ê¸°ê°„ (ì¼)</label>
                            <input type="number" class="form-control" id="retentionDays" value="30" min="1" required>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ì·¨ì†Œ</button>
                    <button type="button" class="btn btn-primary" onclick="createSchedule()">ì¶”ê°€</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // ë‚ ì§œ ì„ íƒê¸° ì´ˆê¸°í™”
        flatpickr(".datepicker", {
            dateFormat: "Y-m-d",
            locale: "ko"
        });

        // íšŒì› ëª©ë¡ ë¡œë“œ
        function loadMembers() {
            fetch('/api/members', { credentials: 'same-origin' })
                .then(response => response.json())
                .then(members => {
                    const tbody = document.getElementById('membersList');
                    tbody.innerHTML = '';
                    members.forEach((member, index) => {
                        const expiryDate = new Date(member.expiry_date);
                        const today = new Date();
                        const diffDays = Math.ceil((expiryDate - today) / (1000 * 60 * 60 * 24));
                        
                        let rowClass = '';
                        if (diffDays < 0) {
                            rowClass = 'expired';
                        } else if (diffDays <= 7) {
                            rowClass = 'expiring-soon';
                        }

                        // ê¸ˆì•¡ì— ì²œë‹¨ìœ„ ì½¤ë§ˆ ì¶”ê°€
                        const formattedAmount = member.deposit_amount.toLocaleString() + 'ì›';

                        tbody.innerHTML += `
                            <tr class="${rowClass}">
                                <td>${index + 1}</td>
                                <td>${member.name}</td>
                                <td>${member.phone}</td>
                                <td>${member.registration_date}</td>
                                <td>${member.expiry_date}</td>
                                <td>${formattedAmount}</td>
                                <td>${member.referrer || ''}</td>
                                <td>${member.cids.join(', ')}</td>
                                <td>
                                    <button class="btn btn-sm btn-primary" onclick="editMember(${member.id})">ìˆ˜ì •</button>
                                    <button class="btn btn-sm btn-danger" onclick="deleteMember(${member.id})">ì‚­ì œ</button>
                                </td>
                            </tr>
                        `;
                    });
                });
        }

        // íšŒì› ìˆ˜ì • í¼ í‘œì‹œ
        function editMember(id) {
            fetch(`/api/members/${id}`)
                .then(response => response.json())
                .then(member => {
                    const form = document.getElementById('editForm');
                    form.id.value = member.id;
                    form.name.value = member.name;
                    form.phone.value = member.phone;
                    form.registration_date.value = member.registration_date;
                    form.expiry_date.value = member.expiry_date;
                    form.deposit_amount.value = member.deposit_amount;
                    form.referrer.value = member.referrer || '';

                    const cidContainer = document.getElementById('editCidInputs');
                    cidContainer.innerHTML = '';
                    member.cids.forEach(cid => {
                        addEditCidInput(cid);
                    });

                    document.getElementById('editFormOverlay').style.display = 'block';
                    document.getElementById('editMemberForm').style.display = 'block';
                });
        }

        // íšŒì› ìˆ˜ì • í¼ ìˆ¨ê¸°ê¸°
        function hideEditMemberForm() {
            document.getElementById('editFormOverlay').style.display = 'none';
            document.getElementById('editMemberForm').style.display = 'none';
        }

        // ìˆ˜ì •ìš© CID ì…ë ¥ í•„ë“œ ì¶”ê°€
        function addEditCidInput(value = '') {
            const container = document.getElementById('editCidInputs');
            const div = document.createElement('div');
            div.className = 'cid-input';
            div.innerHTML = `
                <div class="input-group">
                    <input type="text" class="form-control" name="cids[]" value="${value}">
                    <button type="button" class="btn btn-danger" onclick="this.parentElement.remove()">ì‚­ì œ</button>
                </div>
            `;
            container.appendChild(div);
        }

        // íšŒì› ìˆ˜ì • í¼ ì œì¶œ
        document.getElementById('editForm').onsubmit = function(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            removeCommas(formData);
            const data = {
                id: formData.get('id'),
                name: formData.get('name'),
                phone: formData.get('phone'),
                registration_date: formData.get('registration_date'),
                expiry_date: formData.get('expiry_date'),
                deposit_amount: parseInt(formData.get('deposit_amount')) || 0,
                referrer: formData.get('referrer'),
                cids: Array.from(formData.getAll('cids[]')).filter(cid => cid)
            };

            fetch(`/api/members/${data.id}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(() => {
                loadMembers();
                hideEditMemberForm();
            });
        };

        // ë‚ ì§œ ê¸°ì¤€ í•„í„°ë§
        function filterByDate(period) {
            const rows = document.getElementById('membersList').getElementsByTagName('tr');
            const today = new Date();
            
            Array.from(rows).forEach(row => {
                const registrationDate = new Date(row.cells[3].textContent);
                const diffDays = Math.ceil((today - registrationDate) / (1000 * 60 * 60 * 24));
                
                switch(period) {
                    case 'today':
                        row.style.display = diffDays <= 1 ? '' : 'none';
                        break;
                    case 'week':
                        row.style.display = diffDays <= 7 ? '' : 'none';
                        break;
                    case 'month':
                        row.style.display = diffDays <= 30 ? '' : 'none';
                        break;
                }
            });
        }

        // í•„í„° ì´ˆê¸°í™”
        function resetFilter() {
            const rows = document.getElementById('membersList').getElementsByTagName('tr');
            Array.from(rows).forEach(row => row.style.display = '');
            document.getElementById('searchInput').value = '';
        }

        // íšŒì› ì¶”ê°€ í¼ í‘œì‹œ/ìˆ¨ê¹€
        function showAddMemberForm() {
            document.getElementById('addMemberForm').style.display = 'block';
        }

        function hideAddMemberForm() {
            document.getElementById('addMemberForm').style.display = 'none';
            document.getElementById('memberForm').reset();
        }

        // CID ì…ë ¥ í•„ë“œ ì¶”ê°€
        function addCidInput() {
            const container = document.getElementById('cidInputs');
            const div = document.createElement('div');
            div.className = 'cid-input';
            div.innerHTML = `
                <div class="input-group">
                    <input type="text" class="form-control" name="cids[]">
                    <button type="button" class="btn btn-danger" onclick="this.parentElement.remove()">ì‚­ì œ</button>
                </div>
            `;
            container.appendChild(div);
        }

        // íšŒì› ì¶”ê°€
        document.getElementById('memberForm').onsubmit = function(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            removeCommas(formData);
            const data = {
                name: formData.get('name'),
                phone: formData.get('phone'),
                registration_date: formData.get('registration_date'),
                expiry_date: formData.get('expiry_date'),
                deposit_amount: parseInt(formData.get('deposit_amount')) || 0,
                referrer: formData.get('referrer'),
                cids: Array.from(formData.getAll('cids[]')).filter(cid => cid)
            };

            fetch('/api/members', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                credentials: 'same-origin',  // ì¿ í‚¤/ì„¸ì…˜ í¬í•¨
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(result => {
                if (result.error) {
                    // ğŸ¯ Toastë¡œ ì—ëŸ¬ ì•Œë¦¼! (ë” ì„¸ë ¨ëœ ë°©ì‹)
                    showToast('error', result.error);
                } else {
                    // ì„±ê³µì‹œì—ë§Œ ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                    showToast('success', 'íšŒì›ì´ ì„±ê³µì ìœ¼ë¡œ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!');
                    loadMembers();
                    hideAddMemberForm();
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showToast('error', 'íšŒì› ë“±ë¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            });
        };

        // íšŒì› ì‚­ì œ
        function deleteMember(id) {
            if (confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                fetch(`/api/members/${id}`, {
                    method: 'DELETE'
                })
                .then(() => loadMembers());
            }
        }

        // ì—‘ì…€ ë‚´ë³´ë‚´ê¸°
        function exportExcel() {
            window.location.href = '/api/export';
        }

        // ë¡œê·¸ì•„ì›ƒ
        function logout() {
            window.location.href = '/';
        }

        // ì´ˆê¸° ë¡œë“œ
        loadMembers();

        // ê²€ìƒ‰ ê¸°ëŠ¥ ê°œì„ 
        document.getElementById('searchInput').addEventListener('keyup', function() {
            const searchText = this.value.toLowerCase();
            const rows = document.getElementById('membersList').getElementsByTagName('tr');
            
            Array.from(rows).forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchText) ? '' : 'none';
            });
        });

        // ê¸ˆì•¡ ì…ë ¥ í•„ë“œì— ì²œë‹¨ìœ„ ì½¤ë§ˆ ì¶”ê°€
        function formatNumber(input) {
            let value = input.value.replace(/[^\d]/g, '');
            input.value = Number(value).toLocaleString();
        }

        // í¼ ì œì¶œ ì‹œ ì½¤ë§ˆ ì œê±°
        function removeCommas(formData) {
            const amount = formData.get('deposit_amount');
            if (amount) {
                formData.set('deposit_amount', amount.replace(/,/g, ''));
            }
            return formData;
        }

        function changePassword() {
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            fetch('/change-password', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                credentials: 'same-origin',
                body: JSON.stringify({
                    current_password: currentPassword,
                    new_password: newPassword,
                    confirm_password: confirmPassword
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    alert(data.error);
                } else {
                    alert(data.message);
                    document.getElementById('changePasswordForm').reset();
                    bootstrap.Modal.getInstance(document.getElementById('changePasswordModal')).hide();
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            });
        }

        function showMembers() {
            document.getElementById('membersSection').style.display = 'block';
            document.getElementById('apiKeysSection').style.display = 'none';
            document.getElementById('apiLogsSection').style.display = 'none';
        }

        function showApiKeys() {
            document.getElementById('membersSection').style.display = 'none';
            document.getElementById('apiKeysSection').style.display = 'block';
            document.getElementById('apiLogsSection').style.display = 'none';
            loadApiKeys();
        }

        function showApiLogs() {
            document.getElementById('membersSection').style.display = 'none';
            document.getElementById('apiKeysSection').style.display = 'none';
            document.getElementById('apiLogsSection').style.display = 'block';
            loadApiLogs(1);
        }

        function loadApiKeys() {
            fetch('/api/keys', { credentials: 'same-origin' })
                .then(response => response.json())
                .then(keys => {
                    const tbody = document.getElementById('apiKeysList');
                    tbody.innerHTML = '';
                    
                    keys.forEach(key => {
                        const tr = document.createElement('tr');
                        tr.innerHTML = `
                            <td>${key.name}</td>
                            <td><code>${key.key}</code></td>
                            <td>${key.created_at}</td>
                            <td>${key.last_used_at || '-'}</td>
                            <td>${key.is_active ? '<span class="badge bg-success">í™œì„±</span>' : '<span class="badge bg-danger">ë¹„í™œì„±</span>'}</td>
                            <td>
                                ${key.is_active ? 
                                    `<button class="btn btn-sm btn-danger" onclick="deleteApiKey(${key.id})">ë¹„í™œì„±í™”</button>` : 
                                    '-'}
                            </td>
                        `;
                        tbody.appendChild(tr);
                    });
                });
        }

        function showCreateApiKeyModal() {
            document.getElementById('createApiKeyForm').reset();
            new bootstrap.Modal(document.getElementById('createApiKeyModal')).show();
        }

        function createApiKey() {
            const name = document.getElementById('apiKeyName').value;
            
            fetch('/api/keys', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                credentials: 'same-origin',
                body: JSON.stringify({ name })
            })
            .then(response => response.json())
            .then(key => {
                bootstrap.Modal.getInstance(document.getElementById('createApiKeyModal')).hide();
                loadApiKeys();
                alert(`API í‚¤ê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤: ${key.key}`);
            });
        }

        function deleteApiKey(id) {
            if (!confirm('ì´ API í‚¤ë¥¼ ë¹„í™œì„±í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            
            fetch(`/api/keys/${id}`, {
                method: 'DELETE'
            })
            .then(() => {
                loadApiKeys();
            });
        }

        function loadApiLogs(page) {
            fetch(`/api/logs?page=${page}`)
                .then(response => response.json())
                .then(data => {
                    const tbody = document.getElementById('apiLogsList');
                    tbody.innerHTML = '';
                    
                    data.logs.forEach(log => {
                        const tr = document.createElement('tr');
                        tr.innerHTML = `
                            <td>${log.timestamp}</td>
                            <td>${log.api_key || '-'}</td>
                            <td>${log.endpoint}</td>
                            <td>${log.method}</td>
                            <td>${log.status_code || '-'}</td>
                            <td>${log.ip_address}</td>
                        `;
                        tbody.appendChild(tr);
                    });
                    
                    // í˜ì´ì§€ë„¤ì´ì…˜ ì—…ë°ì´íŠ¸
                    const pagination = document.getElementById('apiLogsPagination');
                    pagination.innerHTML = '';
                    
                    for (let i = 1; i <= data.pages; i++) {
                        const li = document.createElement('li');
                        li.className = `page-item${i === data.current_page ? ' active' : ''}`;
                        li.innerHTML = `
                            <a class="page-link" href="#" onclick="loadApiLogs(${i})">${i}</a>
                        `;
                        pagination.appendChild(li);
                    }
                });
        }

        // ì´ˆê¸° í˜ì´ì§€ ë¡œë“œ ì‹œ íšŒì› ëª©ë¡ í‘œì‹œ
        showMembers();

        function showBackups() {
            document.getElementById('membersSection').style.display = 'none';
            document.getElementById('apiKeysSection').style.display = 'none';
            document.getElementById('apiLogsSection').style.display = 'none';
            document.getElementById('backupsSection').style.display = 'block';
            loadBackups();
            loadSchedules();
        }

        function loadBackups() {
            fetch('/api/backups')
                .then(response => response.json())
                .then(backups => {
                    const tbody = document.getElementById('backupsList');
                    tbody.innerHTML = '';
                    
                    backups.forEach(backup => {
                        const tr = document.createElement('tr');
                        const size = formatFileSize(backup.size);
                        tr.innerHTML = `
                            <td>${backup.created_at}</td>
                            <td>${backup.filename}</td>
                            <td>${size}</td>
                            <td>${backup.description || '-'}</td>
                            <td>${backup.is_auto ? '<span class="badge bg-info">ìë™</span>' : '<span class="badge bg-primary">ìˆ˜ë™</span>'}</td>
                            <td>
                                <button class="btn btn-sm btn-warning me-1" onclick="restoreBackup(${backup.id})">ë³µì›</button>
                                ${!backup.is_auto ? `<button class="btn btn-sm btn-danger" onclick="deleteBackup(${backup.id})">ì‚­ì œ</button>` : ''}
                            </td>
                        `;
                        tbody.appendChild(tr);
                    });
                });
        }

        function loadSchedules() {
            fetch('/api/backup-schedules')
                .then(response => response.json())
                .then(schedules => {
                    const container = document.getElementById('schedulesList');
                    container.innerHTML = '';
                    
                    schedules.forEach(schedule => {
                        const card = document.createElement('div');
                        card.className = 'card mb-3';
                        card.innerHTML = `
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <h5 class="card-title mb-0">
                                        ${formatFrequency(schedule.frequency)}
                                        <span class="badge ${schedule.is_active ? 'bg-success' : 'bg-danger'} ms-2">
                                            ${schedule.is_active ? 'í™œì„±' : 'ë¹„í™œì„±'}
                                        </span>
                                    </h5>
                                    <button class="btn btn-sm btn-danger" onclick="deleteSchedule(${schedule.id})">ì‚­ì œ</button>
                                </div>
                                <p class="card-text">
                                    ì‹¤í–‰ ì‹œê°„: ${schedule.time}<br>
                                    ë³´ê´€ ê¸°ê°„: ${schedule.retention_days}ì¼<br>
                                    ë§ˆì§€ë§‰ ì‹¤í–‰: ${schedule.last_run || '-'}
                                </p>
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" ${schedule.is_active ? 'checked' : ''}
                                        onchange="toggleSchedule(${schedule.id}, this.checked)">
                                    <label class="form-check-label">í™œì„±í™”</label>
                                </div>
                            </div>
                        `;
                        container.appendChild(card);
                    });
                });
        }

        function formatFrequency(frequency) {
            switch (frequency) {
                case 'daily': return 'ë§¤ì¼';
                case 'weekly': return 'ë§¤ì£¼';
                case 'monthly': return 'ë§¤ì›”';
                default: return frequency;
            }
        }

        function formatFileSize(bytes) {
            const units = ['B', 'KB', 'MB', 'GB'];
            let size = bytes;
            let unitIndex = 0;
            
            while (size >= 1024 && unitIndex < units.length - 1) {
                size /= 1024;
                unitIndex++;
            }
            
            return `${size.toFixed(1)} ${units[unitIndex]}`;
        }

        function createBackup() {
            const description = prompt('ë°±ì—… ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš” (ì„ íƒì‚¬í•­):');
            
            fetch('/api/backups', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ description })
            })
            .then(response => response.json())
            .then(() => {
                loadBackups();
            });
        }

        function deleteBackup(id) {
            if (!confirm('ì´ ë°±ì—…ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            
            fetch(`/api/backups/${id}`, {
                method: 'DELETE'
            })
            .then(() => {
                loadBackups();
            });
        }

        function restoreBackup(id) {
            if (!confirm('ì´ ë°±ì—…ìœ¼ë¡œ ë³µì›í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì£¼ì˜: í˜„ì¬ ë°ì´í„°ëŠ” ëª¨ë‘ ë°±ì—… ì‹œì ì˜ ë°ì´í„°ë¡œ ëŒ€ì²´ë©ë‹ˆë‹¤.')) return;
            
            fetch(`/api/backups/${id}/restore`, {
                method: 'POST'
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    alert(data.error);
                } else {
                    alert(data.message);
                    location.reload();
                }
            });
        }

        function showCreateScheduleModal() {
            document.getElementById('createScheduleForm').reset();
            new bootstrap.Modal(document.getElementById('createScheduleModal')).show();
        }

        function createSchedule() {
            const data = {
                frequency: document.getElementById('scheduleFrequency').value,
                time: document.getElementById('scheduleTime').value,
                retention_days: parseInt(document.getElementById('retentionDays').value)
            };
            
            fetch('/api/backup-schedules', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(() => {
                bootstrap.Modal.getInstance(document.getElementById('createScheduleModal')).hide();
                loadSchedules();
            });
        }

        function deleteSchedule(id) {
            if (!confirm('ì´ ë°±ì—… ìŠ¤ì¼€ì¤„ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            
            fetch(`/api/backup-schedules/${id}`, {
                method: 'DELETE'
            })
            .then(() => {
                loadSchedules();
            });
        }

        function toggleSchedule(id, isActive) {
            fetch(`/api/backup-schedules/${id}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ is_active: isActive })
            })
            .then(() => {
                loadSchedules();
            });
        }

        function showStats() {
            document.getElementById('membersSection').style.display = 'none';
            document.getElementById('apiKeysSection').style.display = 'none';
            document.getElementById('apiLogsSection').style.display = 'none';
            document.getElementById('backupsSection').style.display = 'none';
            document.getElementById('statsSection').style.display = 'block';
            loadStats(30);  // ê¸°ë³¸ê°’: 30ì¼
        }

        let dailyTrendsChart = null;
        let apiUsageChart = null;

        function loadStats(days) {
            // ë²„íŠ¼ í™œì„±í™” ìƒíƒœ ë³€ê²½
            document.querySelectorAll('.btn-group .btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`.btn-group .btn:nth-child(${days === 30 ? 2 : days === 7 ? 1 : 3})`).classList.add('active');
            
            // í†µê³„ ê°œìš” ë¡œë“œ
            fetch(`/api/stats/overview?days=${days}`)
                .then(response => response.json())
                .then(data => {
                    // íšŒì› í˜„í™©
                    document.getElementById('totalMembers').textContent = data.members.total.toLocaleString();
                    document.getElementById('activeMembers').textContent = data.members.active.toLocaleString();
                    document.getElementById('newMembers').textContent = data.members.new.toLocaleString();
                    
                    // CID í˜„í™©
                    document.getElementById('totalCids').textContent = data.cids.total.toLocaleString();
                    document.getElementById('activeCids').textContent = data.cids.active.toLocaleString();
                    document.getElementById('avgCidsPerMember').textContent = data.cids.per_member_avg.toFixed(1);
                    
                    // API ì‚¬ìš©ëŸ‰
                    document.getElementById('totalApiCalls').textContent = data.api.total_calls.toLocaleString();
                    document.getElementById('apiSuccessRate').textContent = (data.api.success_rate * 100).toFixed(1) + '%';
                    document.getElementById('avgDailyCalls').textContent = Math.round(data.api.total_calls / days).toLocaleString();
                    
                    // ì…ê¸ˆ í˜„í™©
                    document.getElementById('totalDeposit').textContent = data.members.total_deposit.toLocaleString() + 'ì›';
                    document.getElementById('avgDeposit').textContent = Math.round(data.members.avg_deposit).toLocaleString() + 'ì›';
                });
            
            // ì¼ë³„ í†µê³„ ë¡œë“œ
            fetch(`/api/stats/daily?days=${days}`)
                .then(response => response.json())
                .then(data => {
                    const dates = data.map(d => d.date);
                    const activeMembers = data.map(d => d.active_members);
                    const apiCalls = data.map(d => d.api_calls);
                    
                    if (dailyTrendsChart) {
                        dailyTrendsChart.destroy();
                    }
                    
                    dailyTrendsChart = new Chart(
                        document.getElementById('dailyTrendsChart'),
                        {
                            type: 'line',
                            data: {
                                labels: dates,
                                datasets: [
                                    {
                                        label: 'í™œì„± íšŒì›',
                                        data: activeMembers,
                                        borderColor: 'rgb(75, 192, 192)',
                                        tension: 0.1
                                    },
                                    {
                                        label: 'API í˜¸ì¶œ',
                                        data: apiCalls,
                                        borderColor: 'rgb(255, 99, 132)',
                                        tension: 0.1
                                    }
                                ]
                            },
                            options: {
                                responsive: true,
                                scales: {
                                    y: {
                                        beginAtZero: true
                                    }
                                }
                            }
                        }
                    );
                });
            
            // API ì‚¬ìš© ë¶„ì„ ë¡œë“œ
            fetch(`/api/stats/api-usage?days=${days}`)
                .then(response => response.json())
                .then(data => {
                    if (apiUsageChart) {
                        apiUsageChart.destroy();
                    }
                    
                    const hourlyData = Array(24).fill(0);
                    data.by_hour.forEach(item => {
                        hourlyData[item.hour] = item.count;
                    });
                    
                    apiUsageChart = new Chart(
                        document.getElementById('apiUsageChart'),
                        {
                            type: 'bar',
                            data: {
                                labels: Array.from({length: 24}, (_, i) => `${i}ì‹œ`),
                                datasets: [{
                                    label: 'ì‹œê°„ëŒ€ë³„ API í˜¸ì¶œ',
                                    data: hourlyData,
                                    backgroundColor: 'rgba(54, 162, 235, 0.5)'
                                }]
                            },
                            options: {
                                responsive: true,
                                scales: {
                                    y: {
                                        beginAtZero: true
                                    }
                                }
                            }
                        }
                    );
                });
        }

        // íšŒì› í™œë™ ë‚´ì—­ ì¡°íšŒ
        function showMemberActivity(memberId) {
            fetch(`/api/stats/members/${memberId}/activity`)
                .then(response => response.json())
                .then(activities => {
                    const activityList = activities.map(activity => `
                        <div class="activity-item">
                            <div class="activity-time">${activity.timestamp}</div>
                            <div class="activity-type">${formatActivityType(activity.activity_type)}</div>
                            ${activity.amount ? `<div class="activity-amount">${activity.amount.toLocaleString()}ì›</div>` : ''}
                            ${activity.details ? `<div class="activity-details">${activity.details}</div>` : ''}
                        </div>
                    `).join('');
                    
                    // ëª¨ë‹¬ë¡œ í‘œì‹œ
                    const modal = new bootstrap.Modal(document.getElementById('activityModal'));
                    document.getElementById('activityModalBody').innerHTML = activityList;
                    modal.show();
                });
        }

        function formatActivityType(type) {
            switch (type) {
                case 'registration': return 'íšŒì› ë“±ë¡';
                case 'renewal': return 'ê¸°ê°„ ì—°ì¥';
                case 'deposit': return 'ì…ê¸ˆ';
                default: return type;
            }
        }

        // CSS ìŠ¤íƒ€ì¼ ì¶”ê°€
        const style = document.createElement('style');
        style.textContent = `
            .stats-item {
                display: flex;
                justify-content: space-between;
                margin-bottom: 10px;
            }
            .stats-item strong {
                color: #007bff;
            }
            .activity-item {
                border-bottom: 1px solid #eee;
                padding: 10px 0;
            }
            .activity-time {
                color: #666;
                font-size: 0.9em;
            }
            .activity-type {
                font-weight: bold;
                color: #007bff;
            }
            .activity-amount {
                color: #28a745;
            }
            .activity-details {
                color: #666;
                font-size: 0.9em;
                margin-top: 5px;
            }
        `;
        document.head.appendChild(style);
        // Toast ì•Œë¦¼ ì‹œìŠ¤í…œ ì¶”ê°€
        function showToast(type, message) {
            const toastContainer = document.getElementById('toastContainer') || createToastContainer();
            
            const toastHtml = `
                <div class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-delay="5000">
                    <div class="toast-header ${type === 'success' ? 'bg-success' : 'bg-danger'} text-white">
                        <strong class="me-auto">${type === 'success' ? 'ì„±ê³µ' : 'ì˜¤ë¥˜'}</strong>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast"></button>
                    </div>
                    <div class="toast-body">
                        ${message}
                    </div>
                </div>
            `;
            
            toastContainer.insertAdjacentHTML('beforeend', toastHtml);
            const toastElement = toastContainer.lastElementChild;
            const toast = new bootstrap.Toast(toastElement);
            toast.show();
            
            // Toastê°€ ìˆ¨ê²¨ì§„ í›„ DOMì—ì„œ ì œê±°
            toastElement.addEventListener('hidden.bs.toast', () => {
                toastElement.remove();
            });
        }
        
        function createToastContainer() {
            const container = document.createElement('div');
            container.id = 'toastContainer';
            container.className = 'toast-container position-fixed top-0 end-0 p-3';
            container.style.zIndex = '9999';
            document.body.appendChild(container);
            return container;
        }
        
        // ì‹¤ì‹œê°„ ì „í™”ë²ˆí˜¸ ì¤‘ë³µ ê²€ì‚¬
        function checkPhoneDuplicate(input) {
            const phone = input.value.trim();
            const validationDiv = document.getElementById('phoneValidation');
            
            if (!phone) {
                validationDiv.innerHTML = '';
                input.classList.remove('is-valid', 'is-invalid');
                return;
            }
            
            fetch('/api/members')
                .then(response => response.json())
                .then(members => {
                    const isDuplicate = members.some(member => member.phone === phone);
                    
                    if (isDuplicate) {
                        input.classList.remove('is-valid');
                        input.classList.add('is-invalid');
                        validationDiv.innerHTML = '<span class="text-danger">âš ï¸ ì´ë¯¸ ë“±ë¡ëœ ì „í™”ë²ˆí˜¸ì…ë‹ˆë‹¤!</span>';
                    } else {
                        input.classList.remove('is-invalid');
                        input.classList.add('is-valid');
                        validationDiv.innerHTML = '<span class="text-success">âœ… ì‚¬ìš© ê°€ëŠ¥í•œ ì „í™”ë²ˆí˜¸ì…ë‹ˆë‹¤!</span>';
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    validationDiv.innerHTML = '<span class="text-warning">âš ï¸ ì¤‘ë³µ ê²€ì‚¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</span>';
                });
        }
    </script>
</body>
</html> 